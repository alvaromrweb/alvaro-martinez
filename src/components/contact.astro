---
import ContentSection from "~/components/content-section.astro";
import ButtonSend from "./ui/buttonSend.astro";
---

<ContentSection title="Contacto" id="contacto">
  <Fragment slot="lead">
    Ponte en contacto conmigo
  </Fragment>

  <form class="space-y-8 w-full max-w-screen-md">
        <div>
            <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Tu email</label>
            <input type="email" id="email" class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 dark:shadow-sm-light" placeholder="nombre@webdev.com" required>
        </div>
        <div>
            <label for="subject" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Asunto</label>
            <input type="text" id="subject" class="block p-3 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500 dark:shadow-sm-light" placeholder="Dime en qué te puedo ayudar" required>
        </div>
        <div class="sm:col-span-2">
            <label for="message" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Tu mensaje</label>
            <textarea id="message" rows="6" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg shadow-sm border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" placeholder="Explícame más en detalle" required></textarea>
        </div>
        <div id="response">

        </div>
        <ButtonSend>Enviar</ButtonSend>
    </form>
  
</ContentSection>

<script>
    const form = document.querySelector('form');
    const responseDiv = document.getElementById('response');
    if(form) {
        form.addEventListener('submit', async e => {
            e.preventDefault()
            responseDiv.innerText = ''
            const email = (document.getElementById('email') as HTMLInputElement).value
            const subject = (document.getElementById('subject') as HTMLInputElement).value
            const message = (document.getElementById('message') as HTMLInputElement).value
            console.log({email, subject, message})
            try {
                const res = await fetch("/api/sendForm", {
                    method: 'post',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({email, subject, message}),
                })
                const result = await res.json()
                responseDiv.innerText = result.message
            } catch (error) {
                console.log(error)
                responseDiv.innerText = error.message
            }
        });
    }
</script>
